#!/bin/bash
set -eu

toplevel=$(git rev-parse --show-toplevel)
logdir="$toplevel/.git/bb"
[ -d "$logdir" ] && cd "$logdir"

# shellcheck disable=SC2012,SC2207,SC2016
files=($(ls -1tr "log"* |
	fzf \
	--bind='q:abort,/:unbind(q)+unbind(/)' \
	--no-mouse \
	--no-sort \
	--tac \
	--multi \
	--highlight-line \
	--preview-window=80% \
	--preview='head -$((LINES/2-1)) {}; echo ...; tail -$((LINES/2)) {}'))
if [ ${#files[@]} -eq 0 ]; then
	exit
elif [ ${#files[@]} -eq 1 ]; then
	# To show the filename in prompt.
	less "${files[@]}"
else
	# This may be used to grep selected logs.
	head -n-0 "${files[@]}" | less
fi
